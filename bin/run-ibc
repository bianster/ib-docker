#!/bin/bash

cd /opt/IBController
cp -a IBController.ini /root/IBController/IBController.ini
update-ibcontroller-config.py /root/IBController/IBController.ini $IB_LOGIN $IB_PASSWORD --enable-logging --mode $IB_MODE

if [ -n $TWS_CONF_DIR ]; then
  if [ $TWS_SYNC_CONF == "yes" ]; then
    echo "TWS_SYNC_CONF is enabled."
    if [ -d /root/Jts/$TWS_CONF_DIR ]; then
      echo "Copying /root/Jts/$TWS_CONF_DIR to /tmp/tws/"
      cp -a /root/Jts/$TWS_CONF_DIR /tmp/tws/
    fi
  fi
fi

exec ./IBControllerStart.sh